jobs:
  include:
# -----------------------------------------------
# Linux amd64
# -----------------------------------------------

  - stage: "Build & Tests"
    name: Linux amd64 - GCC/G++
    os: linux
    dist: xenial
    sudo: true
    language: go
    go: 1.12.x
    cache:
      directories:
      - "$HOME/.cache/go-build"
      - "$HOME/gopath/pkg"
    script:
    - export GOOS=linux
    - export GOARCH=amd64
    - export CGO_ENABLED=1
    - make all

  - stage: "Build & Tests"
    name: Linux amd64 - Clang
    if: type = cron OR branch = master
    os: linux
    dist: xenial
    sudo: true
    language: go
    go: 1.12.x
    cache:
      directories:
      - "$HOME/.cache/go-build"
      - "$HOME/gopath/pkg"
    script:
    - export GOOS=linux
    - export GOARCH=amd64
    - export CGO_ENABLED=1
    - export CC=clang
    - make all

# -----------------------------------------------
# Linux i386
# -----------------------------------------------

  - stage: "Build & Tests"
    name: Linux i386 - GCC/G++
    os: linux
    dist: xenial
    sudo: true
    language: go
    go: 1.12.x
    cache:
      directories:
      - "$HOME/.cache/go-build"
      - "$HOME/gopath/pkg"
    addons:
      apt:
        packages:
          - gcc-multilib
          - gccgo-multilib
    script:
    - export GOOS=linux
    - export GOARCH=386
    - export CGO_ENABLED=1
    - make all

  - stage: "Build & Tests"
    name: Linux i386 - Clang
    if: type = cron OR branch = master
    os: linux
    dist: xenial
    sudo: true
    language: go
    go: 1.12.x
    cache:
      directories:
      - "$HOME/.cache/go-build"
      - "$HOME/gopath/pkg"
    addons:
      apt:
        packages:
          - gccgo-multilib
    script:
    - export GOOS=linux
    - export GOARCH=386
    - export CGO_ENABLED=1
    - export CC=clang
    - make all

# -----------------------------------------------
# Linux armhf
# -----------------------------------------------

  - stage: "Build & Tests"
    name: Linux armhf - GCC/G++
    os: linux
    dist: xenial
    sudo: true
    language: go
    go: 1.12.x
    cache:
      directories:
      - "$HOME/.cache/go-build"
      - "$HOME/gopath/pkg"
    addons:
      apt:
        packages:
          - gcc-arm-linux-gnueabihf
          - gccgo-arm-linux-gnueabihf
    script:
    - export GOOS=linux
    - export GOARCH=arm
    - export GOARM=7
    - export CGO_ENABLED=1
    - export GCCGO=arm-linux-gnueabihf-gcc
    - export CC=arm-linux-gnueabihf-gccgo
    - make all

# -----------------------------------------------
# Linux arm64
# -----------------------------------------------

  - stage: "Build & Tests"
    name: Linux arm64 - GCC/G++
    os: linux
    dist: xenial
    sudo: true
    language: go
    go: 1.12.x
    cache:
      directories:
      - "$HOME/.cache/go-build"
      - "$HOME/gopath/pkg"
    addons:
      apt:
        packages:
          - gcc-aarch64-linux-gnu
          - gccgo-aarch64-linux-gnu
    script:
    - export GOOS=linux
    - export GOARCH=arm64
    - export CGO_ENABLED=1
    - export GCCGO=aarch64-linux-gnu-gccgo
    - export CC=aarch64-linux-gnu-gcc
    - make all

# -----------------------------------------------
# MacOS amd64
# -----------------------------------------------

  - stage: "Build & Tests"
    name: MacOS amd64 - Clang
    if: type = cron OR branch = master
    os: osx
    language: go
    go: 1.12.x
    cache:
      directories:
      - "$HOME/Library/Caches/go-build"
      - "$HOME/gopath/pkg"
    script:
    - export GOOS=darwin
    - export GOARCH=amd64
    - export CGO_ENABLED=1
    - make all

# -----------------------------------------------
# Windows amd64
# -----------------------------------------------

  - stage: "Build & Tests"
    name: Windows amd64 - MinGw
    if: type = cron OR branch = master
    os: windows
    language: go
    go: 1.12.x
    install: 
    - choco install make 
    script:
    - export GOOS=windows
    - export GOARCH=amd64
    - export CGO_ENABLED=1
    - make all

notifications:
  slack:
    rooms:
    - secure: "P61/XJ4BfN+RRtSJEMjTjFKANxG5K0AoodMR4p1sQz7qEsRv3ow/VtmHdeKsuiirJwVhyjDy2bLtj67r8ezsyMM9KQLp+n9+A4kXJPg4ySbVMjQMZDW0KNaLBth4kcU+Pt61JRBPjM5XlEzJgWQtHauT84H3xJl9jzpvlRCgdRnpTR8GKfRTEQwdoChg5iMTne85lJw6XwU4gY6w8iZpSTrN/cwZv9i7d6Cop1Z2/3HItEiJaL2I2GouKB/EY9ZHd1DP7iH/18bPTfhZfMF10yIw2/CeZxDbwLRnkScLDSU5VihDcxWxP8W5ZTQOjZafxxB9v4cvETBErw3c5Qp2nT4hoJmz8GBmFYjIxd6ausK1g8KTCZOPGHK0JaZRepmUVseGC1GwfX3NsmbmBoLv/bqzKNhx0o8T4xqzh9lxqpQKctDKSWy85kZYnKh0cazPQJgy/+Zgw9OCPjpvGi8AzqrJn2gjH388s/DK24rqz+U8KwLyr7W1UrvjMUKuOv9iGiM/ZpYGTMIMXwQfkFrAoGQCU/L2YC7ARKUwejjN+axsG3RJ5hKAOXOKTrjdPk+9i2fgP7Q7SdnHDQuvdzcRH7FL89JtFz2PURj08YA8gzhjfh6ErnaRHKK+9r/zXrD+/VxgxCWTBgqhzgtUycBPPfqLDieiOyNJhudjUWdBw7Y=" 
    on_success: never
    on_failure: always
    on_error: always
    on_pull_requests: false
