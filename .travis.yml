language: go
dist: trusty
sudo: required
services:
  - docker
go:
  - '1.10'
before_install:
  - sudo sysctl -w vm.max_map_count=262144
  - sudo apt-get install ruby2.0 curl
  - gem install cucumber -v 2.0.0
  - docker pull kuzzleio/kuzzle
script:
  - .codepipeline/start_kuzzle.sh
  - make
  - cd test && ./build_cpp_tests.sh
  - ./_build_cpp_tests/KuzzleSDKStepDefs & 
  - cucumber

matrix:
  include:
    - os: linux
      addons:
        apt:
          sources:
            - sourceline: 'ppa:mhier/libboost-latest'
            - ubuntu-toolchain-r-test
          packages:
            - g++-4.9
            - libboost-all-dev
            - build-essential
      env:
         - MATRIX_EVAL="CC=gcc-4.9 && CXX=g++-4.9"

    - os: linux
      addons:
        apt:
          sources:
            - sourceline: 'ppa:mhier/libboost-latest'
            - ubuntu-toolchain-r-test
            - llvm-toolchain-precise-3.6
          packages:
            - clang-3.6
            - libboost-all-dev
            - build-essential
      env:
        - MATRIX_EVAL="CC=clang-3.6 && CXX=clang++-3.6"
